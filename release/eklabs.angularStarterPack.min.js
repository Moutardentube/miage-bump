/**
 * AngularJS Starter Pack
 * @version v0.2.6
 * @link 
 */
"use strict";angular.module("eklabs.angularStarterPack.config",[]).factory("$config",["WEBAPP_CONFIG",function(a){var b=angular.extend({},a);return{get:function(a){return b[a]},getUploadPath:function(){return b.uploadPath}}}]),angular.module("eklabs.angularStarterPack.upload",["ngFileUpload"]).service("uploadImage",function(a,b){return function(c,d,e,f){c.upload=b.upload({url:d,method:"POST",headers:{Authorization:e},file:c,fields:{type:c.type.split("/")[1]}}),c.upload.then(function(b){a(function(){return c.result=b.data,f(b.data)})},function(a){return f(a)}),c.upload.progress(function(a){c.progress=Math.min(100,parseInt(100*a.loaded/a.total))})}}),angular.module("eklabs.angularStarterPack.jsonEditor",["ui.ace"]),angular.module("eklabs.angularStarterPack.jsonEditor").directive("demoJsonEditor",["$log",function(a){return{templateUrl:"eklabs.angularStarterPack/modules/json-editor/directives/editor/view.html",scope:{json:"=?",callback:"=?",options:"=?",listeners:"=?",height:"=?"},link:function(b){b.$watch("options",function(a){});var c={valid:function(b){a.info("Valid JSON on demoJsonEditor directive",b)}};b.$watch("callback",function(a){a?b.actions=angular.extend({},c,a):b.actions=c});var d={onError:function(a){}};b.$watch("listeners",function(a){a?b.listener=angular.extend({},d,a):b.listener=d}),b.$watch("editorError",function(a){a&&b.listener.onError(a)}),b.$watch("json",function(a){b.aceAvailable=!1,a?b.aceModel=b.convertRequestParamsToJson(a):b.aceModel="{\n\t\n}",b.loadAce=moment().valueOf()}),b.$watch("loadAce",function(a){b.aceOption={mode:"json",require:["ace/ext/language_tools"],theme:"chrome",onLoad:function(a){var c=a.getSession();c.on("changeAnnotation",function(){var c=a.getSession().getAnnotations();c.length?b.editorError=c[0]:(b.editorError=!1,b.currentJson=b.convertToJson(a.getValue()))})}},b.aceAvailable=!0}),b.convertRequestParamsToJson=function(a){if(Array.isArray(a)){var c={};return angular.forEach(a,function(a){c[a.key]=a.value}),b.convertToAce(c)}return b.convertToAce(a)},b.convertAceToParams=function(a,c){var d=[];return angular.forEach(a,function(a,e){a instanceof Object?d=d.concat(b.convertAceToParams(a),c+"."+e):d.push({key:c?c+e:e,value:a})}),d},b.convertToAce=function(a){var b="",c="",d=[],e=JSON.stringify(a);return angular.forEach(e,function(a){"{"==a?(d.push("\t"),b+=a+"\n"+d.join("")):","!=a||'"'!=c&&"e"!=c&&"d"!=c?"}"==a?(d.splice(0,1),b+="\n"+d.join("")+a):b+=a:b+=a+"\n"+d.join(""),c=a}),b},b.convertToJson=function(a){return a?a instanceof Object?a:JSON.parse(a):void 0},b.$watch("height",function(a){b.currentHeight=a-20||800,b.maxHeightContainer=a-45})}}}]),angular.module("eklabs.angularStarterPack.forms",[]),angular.module("eklabs.angularStarterPack.forms").directive("myForm",function(a){return{templateUrl:"eklabs.angularStarterPack/modules/forms/directives/my-form/myFormView.html",scope:{user:"=",callback:"=?"},link:function(b){b.$watch("user",function(a){b.myUser=a});var c={onValid:function(b){a.info("my user is : ",b)}};b.$watch("callback",function(a){a instanceof Object?b.actions=angular.extend({},c,a):b.actions=c})}}}),angular.module("eklabs.angularStarterPack.user",["eklabs.angularStarterPack.config"]),angular.module("eklabs.angularStarterPack.user").directive("myUserForm",function(a,b,c,d){return{templateUrl:"eklabs.angularStarterPack/modules/user/directives/my-user-form/myUserForm.html",scope:{user:"=",callback:"=?",height:"=?"},link:function(e){e.$watch("user",function(a){a?e.currentUser=a.clone():e.currentUser=new b,e.currentUser.getId()?e.isCreation=!1:e.isCreation=!0}),e.$watch("height",function(a){a?e.current_height=a-110:e.current_height=400}),e.cancel=function(){e.isLoading=!1,e.callback&&e.callback.cancel?e.callback.cancel():a.warn("No method to go back ...")},e.delete=function(){e.isLoading=!0,e.currentUser.delete().then(function(){e.isLoading=!1,e.cancel()})},e.save=function(){e.isLoading=!0,f(function(a){a&&(e.currentUser.photo=a),g(function(){e.cancel()})})};var f=function(a){e.avatarUploaded?c(e.picFile,d.getUploadPath(),!1,function(b){b?a(b.link):e.errors="Erreur durant la mise a jour de l'avatar"}):a(null)},g=function(a){e.isCreation?e.currentUser.create().then(function(){a()},function(a){e.errors=a}):e.currentUser.update(e.currentUser.toApi()).then(function(){a()},function(a){e.errors=a})};e.avatarUploaded=!1,e.changeAvatar=function(a){e.picFile=a,e.avatarUploaded=!0},e.cancelAvatar=function(){e.avatarUploaded=!1}}}}),angular.module("eklabs.angularStarterPack.user").directive("myUserList",function(a,b){return{templateUrl:"eklabs.angularStarterPack/modules/user/directives/my-user-list/myUserList.html",scope:{callback:"=?",height:"=?",refresh:"=?"},link:function(c){c.isLoading=!0,c.errors=!1;var d=function(){c.users=new b,c.users.fetch().then(function(){c.isLoading=!1},function(a){c.isLoading=!1,c.errors=a})};c.$watch("refresh",function(a){d()}),c.$watch("height",function(a){a?c.current_height=a:c.current_height=400}),c.editUser=function(b){c.callback&&c.callback.editUser?c.callback.editUser(b):a.warn("No function to edit an user",b)},c.filter={name:void 0,pictureActive:!1},c.filterFn=function(a){var b=!0;if(c.filter.name){var d=new RegExp(c.filter.name,"gi"),e=a.name.match(d);if(!e)return!1}return c.filter.pictureActive&&(b=void 0!=a.photo),b}}}}),angular.module("eklabs.angularStarterPack.user").directive("myUserTab",function(a){return{templateUrl:"eklabs.angularStarterPack/modules/user/directives/my-user-tab/myUserTab.html",scope:{height:"=?"},link:function(b){b.tabs=[{title:"User List",icon:"people",directive:"my-user-list",disabled:!1}],b.navigateTo=function(c){switch(c){case"create":b.tabs[0].disabled=!0,b.createNotAvailable=!0,b.currentUser=new a,b.tabs.push({title:"Create a new user",icon:"person",directive:"my-user-form",disabled:!1});break;case"edit":b.tabs[0].disabled=!0,b.createNotAvailable=!0,b.tabs.push({title:"Edit user "+b.currentUser.name,icon:"person",directive:"my-user-form",disabled:!1})}},b.actionsList={editUser:function(a){b.currentUser=a,b.navigateTo("edit")}},b.actionsForm={cancel:function(){b.tabs[0].disabled=!1,b.createNotAvailable=!1,b.tabs.pop(),b.refresh=moment().valueOf()}},b.$watch("height",function(a){a?b.current_height=a-50:b.current_height=500}),b.refresh=moment().valueOf()}}}),angular.module("eklabs.angularStarterPack.user").directive("myUser",function(a,b){return{templateUrl:"eklabs.angularStarterPack/modules/user/directives/my-user/view.html",scope:{user:"=?",callback:"=?"},link:function(c){c.$watch("callback",function(b){a.info("Check callback",b),b&&b.valid?c.isEditable=!0:c.isEditable=!1}),c.$watch("user",function(d){a.info("test user change",d),d?(c.current_user=new b(d),c.user.birthDate=new Date(d.birthDate)):c.current_user=new b,console.log(c.current_user)}),c.isModeEdition=!1,c.goToEdition=function(){c.isModeEdition=!c.isModeEdition,c.userEdit=angular.extend({},c.user)},c.valid=function(a){c.isModeEdition=!c.isModeEdition,c.user=angular.extend({},c.userEdit),c.current_user.create().then(function(a){c.callback.valid(a)},function(a){alert("toto")})}}}}),angular.module("eklabs.angularStarterPack.user").factory("User",function(a,b,c){var d=a.get("api")+"/users/",e=function(a){a&&(this.name=a.name,this.id=a.id,this.photo=a.photo,this.birthdate=a.birthdate)};return e.prototype=Object.create({}),e.prototype.constructor=e,e.prototype.getId=function(){return this.id},e.prototype.getPicture=function(){return this.photo?this.photo:"http://91.134.241.60:8020/images/mbs.core/icons/user.png"},e.prototype.toApi=function(){return{name:this.name,photo:this.photo,birthdate:this.birthdate}},e.prototype.get=function(a){var f=c.defer(),g=d+(a?a:this.id?this.id:void 0);return b.get(g).then(function(a){f.resolve(new e(a.data))},function(a){f.reject(a)}),f.promise},e.prototype.create=function(){var a=this,e=c.defer();return b.post(d,this).then(function(b){a.id=b.data.id,e.resolve(a)},function(a){e.reject(a)}),e.promise},e.prototype.delete=function(){var a=c.defer();return b.delete(d+this.getId()).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},e.prototype.update=function(a){var e=c.defer();return b.put(d+this.getId(),a).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},e.prototype.clone=function(){return new e(this)},e}),angular.module("eklabs.angularStarterPack.user").factory("Users",function(a,b,c,d){var e=a.get("api")+"/users/",f=function(a){this.ids=[],this.items=[],a&&this.addItems(a)};return f.prototype=Object.create({}),f.prototype.constructor=f,f.prototype.fetch=function(){var a=c.defer(),d=this;return b.get(e).then(function(b){d.addItems(b.data),a.resolve()},function(b){a.reject(b)}),a.promise},f.prototype.addItems=function(a){if(Array.isArray(a)){var b=this;angular.forEach(a,function(a){b.addItem(a)})}else this.addItem(data)},f.prototype.addItem=function(a){var b=new d(a);b.getId()&&this.ids.indexOf(b.getId())==-1&&(this.ids.push(b.getId()),this.items.push(b))},f.prototype.isEmpty=function(){return 0==this.ids.length},f}),angular.module("eklabs.angularStarterPack",["eklabs.angularStarterPack.config","eklabs.angularStarterPack.upload","eklabs.angularStarterPack.jsonEditor","eklabs.angularStarterPack.forms","eklabs.angularStarterPack.user"]),angular.module("eklabs.angularStarterPack").filter("momentFormat",function(){return function(a,b){var c=new Date(a);return moment(c).isValid()?moment(c).format(b):a}});